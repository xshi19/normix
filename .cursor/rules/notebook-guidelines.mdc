---
description: Guidelines for creating Jupyter notebooks for distributions
globs: "**/notebooks/**/*.ipynb"
alwaysApply: false
---

# Notebook Guidelines

## Purpose

Each distribution should have an accompanying Jupyter notebook that:
1. Demonstrates the distribution's mathematical properties
2. Validates the implementation visually
3. Serves as documentation/tutorial

## Notebook Structure

Every distribution notebook should follow this structure:

### 1. Title and Introduction (with LaTeX)

```markdown
# Distribution Name Distribution

Brief description and key properties.

**PDF:**

$$p(x|\alpha, \beta) = \frac{\beta^\alpha}{\Gamma(\alpha)} x^{\alpha-1} e^{-\beta x} \quad \text{for } x > 0$$

**Key Properties:**
- Parameter constraints: $\alpha > 0$, $\beta > 0$
- Support: $x > 0$
- Mean: $E[X] = \alpha / \beta$
- Variance: $\text{Var}[X] = \alpha / \beta^2$
```

### 2. Imports and Setup

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats

from normix.distributions.univariate import Distribution

# Set plotting style
plt.style.use('seaborn-v0_8-whitegrid')
%matplotlib inline
```

### 3. Parameter Exploration

Show how different parameters affect the distribution:

```python
fig, axes = plt.subplots(1, 3, figsize=(15, 4))

# Vary parameter 1
for param1 in [0.5, 1.0, 2.0, 5.0]:
    dist = Distribution.from_classical_params(param1=param1, param2=1.0)
    x = np.linspace(0.01, 10, 200)
    axes[0].plot(x, dist.pdf(x), label=f'param1={param1}')

axes[0].set_title('Effect of param1')
axes[0].legend()
# ... repeat for other parameters
```

### 4. Scipy Comparison

Always validate against scipy:

```python
# Compare PDF with scipy
normix_dist = Distribution.from_classical_params(...)
scipy_dist = stats.scipy_distribution(...)

x = np.linspace(0.01, 10, 200)

plt.figure(figsize=(10, 4))
plt.subplot(1, 2, 1)
plt.plot(x, normix_dist.pdf(x), 'b-', label='normix', linewidth=2)
plt.plot(x, scipy_dist.pdf(x), 'r--', label='scipy', linewidth=2)
plt.title('PDF Comparison')
plt.legend()

plt.subplot(1, 2, 2)
plt.plot(x, normix_dist.cdf(x), 'b-', label='normix', linewidth=2)
plt.plot(x, scipy_dist.cdf(x), 'r--', label='scipy', linewidth=2)
plt.title('CDF Comparison')
plt.legend()
```

### 5. Sampling Validation

```python
# Generate samples and compare histogram to PDF
samples = dist.rvs(size=10000, random_state=42)

plt.figure(figsize=(10, 4))
plt.hist(samples, bins=50, density=True, alpha=0.7, label='Samples')
x = np.linspace(samples.min(), samples.max(), 200)
plt.plot(x, dist.pdf(x), 'r-', linewidth=2, label='Theoretical PDF')
plt.title('Sampling Validation')
plt.legend()

# Print statistics comparison
print(f"Sample mean: {np.mean(samples):.4f}, Theoretical: {dist.mean():.4f}")
print(f"Sample var:  {np.var(samples):.4f}, Theoretical: {dist.var():.4f}")
```

### 6. Exponential Family Properties

Demonstrate the exponential family structure:

```python
# Show parameter conversions
print("Classical parameters:", dist.get_classical_params())
print("Natural parameters:", dist.get_natural_params())
print("Expectation parameters:", dist.get_expectation_params())

# Verify sufficient statistics match expectation parameters
t_samples = dist._sufficient_statistics(samples)
eta_sample = np.mean(t_samples, axis=0)
eta_theory = dist.get_expectation_params()
print(f"\nE[t(X)] from samples: {eta_sample}")
print(f"E[t(X)] theoretical:  {eta_theory}")
```

### 7. MLE Fitting

```python
# Generate data from known parameters
true_params = {'param1': 2.0, 'param2': 1.5}
true_dist = Distribution.from_classical_params(**true_params)
data = true_dist.rvs(size=2000, random_state=42)

# Fit distribution
fitted_dist = Distribution().fit(data)

print("True parameters:", true_params)
print("Fitted parameters:", fitted_dist.get_classical_params())

# Visual comparison
plt.figure(figsize=(10, 4))
plt.hist(data, bins=50, density=True, alpha=0.7, label='Data')
x = np.linspace(data.min(), data.max(), 200)
plt.plot(x, true_dist.pdf(x), 'g-', linewidth=2, label='True')
plt.plot(x, fitted_dist.pdf(x), 'r--', linewidth=2, label='Fitted')
plt.legend()
plt.title('MLE Fitting')
```

### 8. Special Cases / Relationships (if applicable)

```python
# Show relationship to other distributions
# e.g., GIG → Gamma when b → 0
# e.g., IG as special case of GIG with p = -1/2
```

## Visualization Standards

```python
# Standard figure sizes
SINGLE_PLOT = (8, 5)
DOUBLE_PLOT = (12, 4)
TRIPLE_PLOT = (15, 4)
GRID_2x2 = (10, 8)

# Colors
PYGH_COLOR = 'tab:blue'
SCIPY_COLOR = 'tab:red'
SAMPLE_COLOR = 'tab:gray'

# Line styles
THEORETICAL_STYLE = '-'
SCIPY_STYLE = '--'
```

## Mathematical Formulas in Markdown (LaTeX Required)

**ALWAYS use LaTeX** for mathematical formulas in notebook markdown cells.

### Display Math (Block)

Use `$$ ... $$` for centered, block-level equations:

```markdown
The PDF is given by:

$$p(x|\alpha, \beta) = \frac{\beta^\alpha}{\Gamma(\alpha)} x^{\alpha-1} e^{-\beta x}$$

The exponential family form:

$$p(x|\theta) = h(x) \exp(\theta^T t(x) - \psi(\theta))$$
```

### Inline Math

Use `$ ... $` for inline math within text:

```markdown
The shape parameter $\alpha > 0$ controls the peakedness, while
the rate parameter $\beta > 0$ controls the scale.

The mean is $E[X] = \alpha / \beta$ and variance is $\text{Var}[X] = \alpha / \beta^2$.
```

### Common Patterns for Distributions

```markdown
## Exponential Family Form

- Sufficient statistics: $t(x) = [\log x, x]$
- Natural parameters: $\theta = [\alpha - 1, -\beta]$
- Log partition: $\psi(\theta) = \log\Gamma(\theta_1 + 1) - (\theta_1 + 1)\log(-\theta_2)$

## Parametrization Conversions

| Parametrization | Parameters |
|-----------------|------------|
| Classical | $\alpha$ (shape), $\beta$ (rate) |
| Natural | $\theta = [\alpha - 1, -\beta]$ |
| Expectation | $\eta = [\psi(\alpha) - \log\beta, \alpha/\beta]$ |
```

## Notebook Naming Convention

```
{distribution_name}_distribution.ipynb
```

Examples:
- `gamma_distribution.ipynb`
- `generalized_inverse_gaussian_distribution.ipynb`
- `variance_gamma_distribution.ipynb`
